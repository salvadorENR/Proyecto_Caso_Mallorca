================================================================================
OPTIMIZACIÃ“N CONTRAFACTUAL - TURISMO SOSTENIBLE MALLORCA
================================================================================

ğŸ“Š Variables explicativas (p=8): ['SchoolingRate', 'Poverty', 'UnaccountedWater', 'OpenEstablishments', 'RenewableResources', 'PassengersArriving', 'MaritimeTraffic', 'VehicleRegistration']
âš–ï¸  Pesos (wâ±¼ = 1/p): 0.1250 para cada variable

ğŸ“ˆ DesviaciÃ³n estÃ¡ndar de cada variable:
c:\Users\Usuario\Documents\Proyecto_Caso_Mallorca-1\SolParte2.py:40: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  print(f"   {col:25s}: Ïƒ = {std_vector[i]:.6f}")
   SchoolingRate            : Ïƒ = 0.283761
   Poverty                  : Ïƒ = 0.305765
   UnaccountedWater         : Ïƒ = 0.254165
   OpenEstablishments       : Ïƒ = 0.311507
   RenewableResources       : Ïƒ = 0.289201
   PassengersArriving       : Ïƒ = 0.304481
   MaritimeTraffic          : Ïƒ = 0.289472
   VehicleRegistration      : Ïƒ = 0.350467

================================================================================
6. FORMULACIÃ“N TEÃ“RICA DEL PROBLEMA DE OPTIMIZACIÃ“N CONTRAFACTUAL
================================================================================

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    MODELO DE OPTIMIZACIÃ“N CONTRAFACTUAL                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO:
---------
Encontrar los cambios mÃ­nimos en las variables explicativas para lograr un
incremento deseado Îµ en el Ã­ndice de turismo sostenible y.

VARIABLES DE DECISIÃ“N:
---------------------
â€¢ Î²â±¼ âˆˆ â„  : Cambio propuesto para la variable xâ±¼ (j = 1, ..., p)
â€¢ Î´â±¼ âˆˆ {0,1}: Indicador binario que vale 1 si se modifica xâ±¼, 0 en caso contrario

FUNCIÃ“N OBJETIVO:
----------------
Minimizar:  Î£â±¼â‚Œâ‚áµ– Î²â±¼ + kÂ·Î£â±¼â‚Œâ‚áµ– Î´â±¼

Donde:
- El primer tÃ©rmino minimiza la magnitud total de los cambios
- El segundo tÃ©rmino penaliza el nÃºmero de variables modificadas
- k es un parÃ¡metro de penalizaciÃ³n (k > 0)

RESTRICCIONES:
-------------

1) RESTRICCIÃ“N DE INCREMENTO DESEADO:
   Î£â±¼â‚Œâ‚áµ– wâ±¼(xâ±¼ + Î²â±¼) â‰¥ y_actual + Îµ

   Equivalentemente:
   Î£â±¼â‚Œâ‚áµ– wâ±¼Â·Î²â±¼ â‰¥ Îµ

2) RESTRICCIÃ“N DE SELECCIÃ“N DE VARIABLES:
   Î¼â‚— â‰¤ Î£â±¼â‚Œâ‚áµ– Î´â±¼ â‰¤ Î¼áµ¤

   Donde:
   - Î¼â‚—: nÃºmero mÃ­nimo de variables a modificar
   - Î¼áµ¤: nÃºmero mÃ¡ximo de variables a modificar

3) RESTRICCIÃ“N DE COTA SUPERIOR DE CAMBIOS:
   Î²â±¼ â‰¤ aÂ·f_std(xâ±¼) = aÂ·Ïƒâ±¼    âˆ€j

   Donde:
   - a: constante definida por el usuario
   - Ïƒâ±¼: desviaciÃ³n estÃ¡ndar de la variable xâ±¼

   JUSTIFICACIÃ“N DE 'a':
   Usaremos a = 0.3 (30% de la desviaciÃ³n estÃ¡ndar) porque:
   â€¢ Permite cambios significativos pero realistas
   â€¢ Evita modificaciones extremas que sean poco factibles
   â€¢ Es consistente con variaciones naturales en los datos histÃ³ricos

4) RESTRICCIÃ“N DE RANGO [0,1]:
   0 â‰¤ xâ±¼ + Î²â±¼ â‰¤ 1    âˆ€j

   Equivalentemente:
   -xâ±¼ â‰¤ Î²â±¼ â‰¤ 1 - xâ±¼    âˆ€j

5) RESTRICCIÃ“N DE ACOPLAMIENTO (Big-M):
   Si Î´â±¼ = 0, entonces Î²â±¼ = 0
   Si Î´â±¼ = 1, entonces Î²â±¼ puede ser cualquier valor vÃ¡lido

   ImplementaciÃ³n:
   mÂ·Î´â±¼ â‰¤ Î²â±¼ â‰¤ MÂ·Î´â±¼    âˆ€j

   Donde:
   - m: nÃºmero negativo grande (ej: -50000)
   - M: nÃºmero positivo grande (ej: 50000)

6) RESTRICCIÃ“N DE NO NEGATIVIDAD DE CAMBIOS (opcional):
   Î²â±¼ â‰¥ 0    âˆ€j

   Esto asegura que solo se incrementen variables, nunca se disminuyan.
   (Se puede omitir si se permiten decrementos)

FORMULACIÃ“N COMPLETA:
--------------------
min  Î£â±¼â‚Œâ‚áµ– Î²â±¼ + kÂ·Î£â±¼â‚Œâ‚áµ– Î´â±¼

s.a.:
    Î£â±¼â‚Œâ‚áµ– wâ±¼Â·Î²â±¼ â‰¥ Îµ                          [Incremento deseado]
    Î¼â‚— â‰¤ Î£â±¼â‚Œâ‚áµ– Î´â±¼ â‰¤ Î¼áµ¤                        [NÃºmero de modificaciones]
    Î²â±¼ â‰¤ aÂ·Ïƒâ±¼                  âˆ€j            [Cota superior]
    mÂ·Î´â±¼ â‰¤ Î²â±¼ â‰¤ MÂ·Î´â±¼           âˆ€j            [Acoplamiento]
    Î²â±¼ â‰¤ 1 - xâ±¼                âˆ€j            [Rango superior]
    Î²â±¼ â‰¥ 0                     âˆ€j            [No negatividad]
    Î´â±¼ âˆˆ {0,1}                 âˆ€j            [Variable binaria]
    Î²â±¼ âˆˆ â„                     âˆ€j            [Variable continua]


================================================================================
7. CAMBIOS PARA INCREMENTOS EN EL AÃ‘O 2024
================================================================================

--------------------------------------------------------------------------------
7.a) Incremento del 1% en 2024
--------------------------------------------------------------------------------

================================================================================
RESULTADOS - AÃ‘O 2024
================================================================================
Estado: Optimal

ğŸ“Š INDICADOR DE SOSTENIBILIDAD:
   y actual:     0.490000
   y nuevo:      0.562599
   Incremento:   0.072599 (14.82%)
   Objetivo:     0.004900 (1.0%)

ğŸ”§ VARIABLES MODIFICADAS (1/8):
       Variable  Valor_Actual  Cambio_Î²  Modificar_Î´  Valor_Nuevo  Cambio_%
MaritimeTraffic       0.80065    0.0392         True      0.83985  4.896021

ğŸ“ˆ MAGNITUD TOTAL DE CAMBIOS: 0.039200

--------------------------------------------------------------------------------
7.b) Incremento del 5% en 2024 (mÃ¡ximo 4 variables)
--------------------------------------------------------------------------------

================================================================================
RESULTADOS - AÃ‘O 2024
================================================================================
Estado: Optimal

ğŸ“Š INDICADOR DE SOSTENIBILIDAD:
   y actual:     0.490000
   y nuevo:      0.582199
   Incremento:   0.092199 (18.82%)
   Objetivo:     0.024500 (5.0%)

ğŸ”§ VARIABLES MODIFICADAS (2/8):
           Variable  Valor_Actual  Cambio_Î²  Modificar_Î´  Valor_Nuevo  Cambio_%
 OpenEstablishments      0.148170   0.09086         True     0.239030 61.321559
VehicleRegistration      0.331331   0.10514         True     0.436471 31.732590

ğŸ“ˆ MAGNITUD TOTAL DE CAMBIOS: 0.196000

================================================================================
8. RECOMENDACIÃ“N: MODIFICAR UNA SOLA VARIABLE PARA INCREMENTO DEL 25%
================================================================================

ESTRATEGIA:
-----------
Para identificar la mejor variable a modificar, probaremos cada una
individualmente y compararemos:
1. Â¿Es factible lograr 25% con una sola variable?
2. Â¿CuÃ¡nto cambio se requiere?
3. Â¿Es realista ese cambio?


--------------------------------------------------------------------------------
Probando: SchoolingRate
--------------------------------------------------------------------------------
âœ— NO FACTIBLE - No se puede lograr 25% con esta variable

--------------------------------------------------------------------------------
Probando: Poverty
--------------------------------------------------------------------------------
âœ— NO FACTIBLE - No se puede lograr 25% con esta variable

--------------------------------------------------------------------------------
Probando: UnaccountedWater
--------------------------------------------------------------------------------
âœ— NO FACTIBLE - No se puede lograr 25% con esta variable

--------------------------------------------------------------------------------
Probando: OpenEstablishments
--------------------------------------------------------------------------------
âœ— NO FACTIBLE - No se puede lograr 25% con esta variable

--------------------------------------------------------------------------------
Probando: RenewableResources
--------------------------------------------------------------------------------
âœ— NO FACTIBLE - No se puede lograr 25% con esta variable

--------------------------------------------------------------------------------
Probando: PassengersArriving
--------------------------------------------------------------------------------
âœ— NO FACTIBLE - No se puede lograr 25% con esta variable

--------------------------------------------------------------------------------
Probando: MaritimeTraffic
--------------------------------------------------------------------------------
âœ— NO FACTIBLE - No se puede lograr 25% con esta variable

--------------------------------------------------------------------------------
Probando: VehicleRegistration
--------------------------------------------------------------------------------
âœ— NO FACTIBLE - No se puede lograr 25% con esta variable

================================================================================
RECOMENDACIÃ“N FINAL
================================================================================

âŒ NINGUNA VARIABLE INDIVIDUAL puede lograr un incremento del 25%
   Se requiere modificar mÃºltiples variables simultÃ¡neamente.

================================================================================
10. FORMULACIÃ“N DE RESTRICCIONES ADICIONALES
================================================================================

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              RESTRICCIONES LÃ“GICAS ADICIONALES                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

a) Si se modifica MaritimeTraffic, tambiÃ©n debe modificarse PassengersArriving
   ---------------------------------------------------------------------------

   FORMULACIÃ“N:
   Î´_MaritimeTraffic â‰¤ Î´_PassengersArriving

   EXPLICACIÃ“N:
   â€¢ Si Î´_MaritimeTraffic = 1 â†’ Î´_PassengersArriving debe ser 1
   â€¢ Si Î´_MaritimeTraffic = 0 â†’ Î´_PassengersArriving puede ser 0 o 1

   CÃ“DIGO PYTHON:
   idx_maritime = feature_cols.index('MaritimeTraffic')
   idx_passengers = feature_cols.index('PassengersArriving')
   model += (delta[idx_maritime] <= delta[idx_passengers],
             "Implicacion_Maritime_Passengers")


b) Se debe modificar una y solo una entre SchoolRate y RenewableResources
   -----------------------------------------------------------------------

   FORMULACIÃ“N:
   Î´_SchoolingRate + Î´_RenewableResources = 1

   EXPLICACIÃ“N:
   â€¢ Exactamente una de las dos variables debe valer 1
   â€¢ Esto garantiza que se modifica una y solo una

   CÃ“DIGO PYTHON:
   idx_school = feature_cols.index('SchoolingRate')
   idx_renewable = feature_cols.index('RenewableResources')
   model += (delta[idx_school] + delta[idx_renewable] == 1,
             "XOR_School_Renewable")


c) Al menos una de las variables Poverty o VehicleRegistration debe modificarse
   -----------------------------------------------------------------------------

   FORMULACIÃ“N:
   Î´_Poverty + Î´_VehicleRegistration â‰¥ 1

   EXPLICACIÃ“N:
   â€¢ La suma debe ser al menos 1
   â€¢ Permite que ambas sean modificadas (suma = 2)
   â€¢ Pero al menos una debe ser modificada

   CÃ“DIGO PYTHON:
   idx_poverty = feature_cols.index('Poverty')
   idx_vehicle = feature_cols.index('VehicleRegistration')
   model += (delta[idx_poverty] + delta[idx_vehicle] >= 1,
             "AtLeastOne_Poverty_Vehicle")


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    IMPLEMENTACIÃ“N CONJUNTA                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def add_all_restrictions(model, beta, delta):
    '''Agrega todas las restricciones adicionales a)-c)'''

    # Obtener Ã­ndices de variables
    idx_maritime = feature_cols.index('MaritimeTraffic')
    idx_passengers = feature_cols.index('PassengersArriving')
    idx_school = feature_cols.index('SchoolingRate')
    idx_renewable = feature_cols.index('RenewableResources')
    idx_poverty = feature_cols.index('Poverty')
    idx_vehicle = feature_cols.index('VehicleRegistration')

    # a) Maritime â†’ Passengers
    model += (delta[idx_maritime] <= delta[idx_passengers],
              "Restriction_a_Maritime_implies_Passengers")

    # b) Exactamente uno: School XOR Renewable
    model += (delta[idx_school] + delta[idx_renewable] == 1,
              "Restriction_b_XOR_School_Renewable")

    # c) Al menos uno: Poverty OR Vehicle
    model += (delta[idx_poverty] + delta[idx_vehicle] >= 1,
              "Restriction_c_AtLeastOne_Poverty_Vehicle")


================================================================================
DEMOSTRACIÃ“N: OptimizaciÃ³n con restricciones a), b) y c)
================================================================================

================================================================================
RESULTADOS - AÃ‘O 2024
================================================================================
Estado: Optimal

ğŸ“Š INDICADOR DE SOSTENIBILIDAD:
   y actual:     0.490000
   y nuevo:      0.582199
   Incremento:   0.092199 (18.82%)
   Objetivo:     0.024500 (5.0%)

ğŸ”§ VARIABLES MODIFICADAS (3/8):
           Variable  Valor_Actual  Cambio_Î²  Modificar_Î´  Valor_Nuevo  Cambio_%
 OpenEstablishments      0.148170  0.093452         True     0.241622 63.070963
 RenewableResources      0.829295  0.086760         True     0.916055 10.461920
VehicleRegistration      0.331331  0.015788         True     0.347119  4.764941

ğŸ“ˆ MAGNITUD TOTAL DE CAMBIOS: 0.196000

âœ“ VERIFICACIÃ“N DE RESTRICCIONES:

  a) Maritime â†’ Passengers:
     Maritime modificado: False
     Passengers modificado: False
     âœ“ Cumple: True

  b) School XOR Renewable:
     School modificado: False
     Renewable modificado: True
     Suma: 1
     âœ“ Cumple: True

  c) Poverty OR Vehicle (al menos uno):
     Poverty modificado: False
     Vehicle modificado: True
     Suma: 1
     âœ“ Cumple: True